<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>XML Relations Network Visualization</title>
    
    <!-- vis.js CDN -->
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        
        #network-container {
            width: 100%;
            height: 900px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 20px;
            background-color: white;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }
        
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 15px;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        h1 {
            color: #2c3e50;
            font-weight: 700;
        }
        
        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div style="text-align: center; margin-bottom: 30px; margin-top: 20px;">
        <h1 style="font-size: 30px; color: #2c3e50;">XML Relations Network Visualization</h1>
    </div>
    
    <div class="card" style="margin: 20px;">
        <div class="card-header">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">üîç Hierarchy Filter:</label>
                    <select class="form-select" id="hierarchy-filter" onchange="filterByHierarchy(this.value)">
                        <option value="all">All Relations</option>
                        <option value="primary">1st Degree (Primary)</option>
                        <option value="secondary">2nd Degree (Secondary)</option>
                        <option value="tertiary">3rd Degree (Tertiary)</option>
                        <option value="potential">Possible New Relations</option>
                        <option value="confirmed">Confirmed New Relations</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">üìä Relation Types:</label>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <label style="color: #FF4444;">
                            <input type="checkbox" id="CitOf" checked onchange="toggleRelation('CitOf')"> CitOf
                        </label>
                        <label style="color: #FF4444;">
                            <input type="checkbox" id="CitIn" checked onchange="toggleRelation('CitIn')"> CitIn
                        </label>
                        <label style="color: #44AA44;">
                            <input type="checkbox" id="SecCit" checked onchange="toggleRelation('SecCit')"> SecCit
                        </label>
                        <label style="color: #ADD8E6;"> <!-- GE√ÑNDERT: ThirdCit Farbe (Light Blue) -->
                            <input type="checkbox" id="ThirdCit" checked onchange="toggleRelation('ThirdCit')"> ThirdCit
                        </label>
                        <label style="color: #964B00;">
                            <input type="checkbox" id="PotCit" checked onchange="toggleRelation('PotCit')"> PotCit
                        </label>
                        <label style="color: #AA44AA;">
                            <input type="checkbox" id="NewCit" checked onchange="toggleRelation('NewCit')"> NewCit
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">üéØ Focus Node:</label>
                    <select class="form-select" id="node-select" onchange="selectNode(this.value)">
                        <option value="">Select Node...</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <div>
                        <button class="btn btn-secondary btn-sm" onclick="clearSelection()">üîÑ Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="network-container"></div>
    
    <div class="legend">
        <h3 style="margin-top: 0; margin-bottom: 10px; font-size: 16px;">Hierarchy Legend</h3>
        <div style="display: flex; flex-direction: column; gap: 5px;">
            <div> Line Colors (Edges) </div>
            <div><span style="color: #FF4444; font-size: 20px;">‚ñ†</span> Primary Relations (1st Degree)</div>
            <div><span style="color: #44AA44; font-size: 20px;">‚ñ†</span> Secondary Relations (2nd Degree)</div>
            <div><span style="color: #ADD8E6; font-size: 20px;">‚ñ†</span> Tertiary Relations (3rd Degree)</div> 
            <div><span style="color: #964B00; font-size: 20px;">‚ñ†</span> Possible New Relations</div>
            <div><span style="color: #AA44AA; font-size: 20px;">‚ñ†</span> Confirmed New Relations</div>
            <div> Node Colors (Nodes) </div>
            <div><span style="color: #FFA500; font-size: 20px;">‚ñ†</span> Bibliography</div>
            <div><span style="color: #4169E1; font-size: 20px;">‚ñ†</span> Persons</div>
        </div>
    </div>

    <script type="text/javascript">
        // Global variables
        var network;
        var nodes, edges;
        var allNodes, allEdges;
        var currentHierarchy = 'all';
        var activeRelations = new Set(['CitOf', 'CitIn', 'SecCit', 'ThirdCit', 'PotCit', 'NewCit']);
        
        // Data from Python
        var nodeData = [{"id": "bibl00001", "label": "Diary of a Madman", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00001\\nTyp: bibliography\\nTitel: Diary of a Madman, Zapiski sumasshedshego \u0417\u0430\u043f\u0438\u0441\u043a\u0438 \u0441\u0443\u043c\u0430\u0441\u0448\u0435\u0434\u0448\u0435\u0433\u043e, Tagebuch eines Wahnsinnigen\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00002", "label": "\"My older brother is a man-eater\" : cannibalism before and after May Fourth, 1919", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00002\\nTyp: bibliography\\nTitel: \"My older brother is a man-eater\" : cannibalism before and after May Fourth, 1919, Zur\u00fcck zur Freude. Studien zur chinesischen Literatur und Lebenswelt und ihrer Rezeption in Ost und West: Festschrift f\u00fcr Wolfgang Kubin (Monumenta Serica Monograph Series)", "shape": "square", "size": 20}, {"id": "bibl00003", "label": "The Book of Rites (Liji)", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00003\\nTyp: bibliography\\nTitel: The Book of Rites (Liji), \u79ae\u8a18, Buch der Riten (Liji)", "shape": "square", "size": 20}, {"id": "bibl00004", "label": "Compendium of Materia Medica (Bencao Gangmu)", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00004\\nTyp: bibliography\\nTitel: Compendium of Materia Medica (Bencao Gangmu), \u672c\u8349\u7db1\u76ee, Bencao Gangmu", "shape": "square", "size": 20}, {"id": "bibl00005", "label": "Zuo Zhuan", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00005\\nTyp: bibliography\\nTitel: Zuo Zhuan, \u5de6\u50b3, Zuozhuan", "shape": "square", "size": 20}, {"id": "bibl00006", "label": "A Bit of Crazy Talk (Yi Duan Feng Hua)", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00006\\nTyp: bibliography\\nTitel: A Bit of Crazy Talk (Yi Duan Feng Hua), New Currents (Xinchao), \u4e00\u6bb5\u760b\u8a71\\n... und 2 weitere", "shape": "square", "size": 20}, {"id": "bibl00007", "label": "People Say I\u00a0am Crazy", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00007\\nTyp: bibliography\\nTitel: People Say I\u00a0am Crazy, New Youth (Xin Qingniang\uff09Vol. 5, No. 3, \u4eba\u5bb6\u8aaa\u6211\u767c\u4e86\u7661\u200b\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00008", "label": "Cannibalism and the Study of the Rites (Chiren yu lijiao)", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00008\\nTyp: bibliography\\nTitel: Cannibalism and the Study of the Rites (Chiren yu lijiao), New Youth (Xin Qingniang\uff09Vol. 6, No. 6, \u5403\u4eba\u8207\u79ae\u6559\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00009", "label": "Politics in Pig-slaughterhouse Style", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00009\\nTyp: bibliography\\nTitel: Politics in Pig-slaughterhouse Style, Mei zhou ping lun, \u5bb0\u8c6c\u5834\u5f0f\u7684\u653f\u6cbb\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00010", "label": "Looking Out From Death. From the Cultural Revolution to Tiananmen Square", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00010\\nTyp: bibliography\\nTitel: Looking Out From Death. From the Cultural Revolution to Tiananmen Square", "shape": "square", "size": 20}, {"id": "bibl00017", "label": "Chinese Characteristics", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00017\\nTyp: bibliography\\nTitel: Chinese Characteristics", "shape": "square", "size": 20}, {"id": "bibl00018", "label": "The Discourse on the New Citizen", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00018\\nTyp: bibliography\\nTitel: The Discourse on the New Citizen, \u65b0\u6c11\u8aaa, Xin Min Shuo", "shape": "square", "size": 20}, {"id": "bibl00019", "label": "Flowers in the Mirror", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00019\\nTyp: bibliography\\nTitel: Flowers in the Mirror, \u93e1\u82b1\u7de3, Jig Hua Yuan", "shape": "square", "size": 20}, {"id": "bibl00020", "label": "Floods and Beasts", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00020\\nTyp: bibliography\\nTitel: Floods and Beasts, New Youth (Xin Qingniang\uff09Vol. 7, No. 5, \u6d2a\u6c34\u8207\u731b\u7378\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00021", "label": "Reading A Call to Arms", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00021\\nTyp: bibliography\\nTitel: Reading A Call to Arms, Literature Weekly, Issue 91, \u8b80\u543b\u558a\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00022", "label": "A Call to Arms", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00022\\nTyp: bibliography\\nTitel: A Call to Arms, \u5436\u558a", "shape": "square", "size": 20}, {"id": "bibl00023", "label": "A Madman's Diary", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00023\\nTyp: bibliography\\nTitel: A Madman's Diary, New Youth Volume 4, no. 5, \u72c2\u4eba\u65e5\u8a30\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00024", "label": "Our Enemies", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00024\\nTyp: bibliography\\nTitel: Our Enemies, Yusi, \u6211\u5011\u7684\u654c\u4eba\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00025", "label": "Children of Xisha", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00025\\nTyp: bibliography\\nTitel: Children of Xisha, \u897f\u6c99\u513f\u5973", "shape": "square", "size": 20}, {"id": "bibl00026", "label": "The Republic of Wine", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00026\\nTyp: bibliography\\nTitel: The Republic of Wine, \u9152\u56fd", "shape": "square", "size": 20}, {"id": "bibl00027", "label": "Ugly Chinaman", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00027\\nTyp: bibliography\\nTitel: Ugly Chinaman, \u919c\u964b\u7684\u4e2d\u570b\u4eba, \u4e11\u964b\u7684\u4e2d\u56fd\u4eba\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00028", "label": "Scarlet Memorial: Tales of Cannibalism in Modern China", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00028\\nTyp: bibliography\\nTitel: Scarlet Memorial: Tales of Cannibalism in Modern China, \u7ea2\u8272\u7eaa\u5ff5\u7891, Hongse jinianbei", "shape": "square", "size": 20}, {"id": "bibl00031", "label": "\u8bba\u4e94\u56db\u65b0\u6587\u5316\u8fd0\u52a8", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00031\\nTyp: bibliography\\nTitel: \u8bba\u4e94\u56db\u65b0\u6587\u5316\u8fd0\u52a8, On the May Fourth New Culture Movement, Lun wusi xinwenhua yundon\\n... und 3 weitere", "shape": "square", "size": 20}, {"id": "bibl00032", "label": "Old Book of Tang, volume 188", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00032\\nTyp: bibliography\\nTitel: Old Book of Tang, volume 188, \u820a\u5510\u66f8, \u5377188, Jiu tangshu, juan 188", "shape": "square", "size": 20}, {"id": "bibl00033", "label": "Hanfeizi Collected Works", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00033\\nTyp: bibliography\\nTitel: Hanfeizi Collected Works, \u97d3\u975e\u5b50\u96c6\u91cb, Hanfeizi jishi", "shape": "square", "size": 20}, {"id": "bibl00034", "label": "Records of the Three Kingdoms", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00034\\nTyp: bibliography\\nTitel: Records of the Three Kingdoms, \u4e09\u570b\u5ff5, Sanguozhi", "shape": "square", "size": 20}, {"id": "bibl00035", "label": "Zhanguoce", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00035\\nTyp: bibliography\\nTitel: Zhanguoce, \u6230\u570b\u7b56", "shape": "square", "size": 20}, {"id": "bibl00036", "label": "A Veteran Worker's Hands", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00036\\nTyp: bibliography\\nTitel: A Veteran Worker's Hands, Chinese literature 1970/1", "shape": "square", "size": 20}, {"id": "bibl00037", "label": "Shiji", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00037\\nTyp: bibliography\\nTitel: Shiji, \u53f2\u8a18", "shape": "square", "size": 20}, {"id": "bibl00011", "label": "Wolf Cub Village", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00011\\nTyp: bibliography\\nTitel: Wolf Cub Village, \u72fc\u5b50\u6751", "shape": "square", "size": 20}, {"id": "bibl00012", "label": "Guanzi", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00012\\nTyp: bibliography\\nTitel: Guanzi, \u7ba1\u5b50", "shape": "square", "size": 20}, {"id": "bibl00013", "label": "Zhuangzi", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00013\\nTyp: bibliography\\nTitel: Zhuangzi, \u838a\u5b50", "shape": "square", "size": 20}, {"id": "bibl00014", "label": "Huangdi Neijing", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00014\\nTyp: bibliography\\nTitel: Huangdi Neijing, \u9ec3\u5e1d\u5167\u7d93", "shape": "square", "size": 20}, {"id": "bibl00015", "label": "Nanjing", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00015\\nTyp: bibliography\\nTitel: Nanjing, \u96e3\u7d93", "shape": "square", "size": 20}, {"id": "bibl00016", "label": "Analects", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00016\\nTyp: bibliography\\nTitel: Analects, \u8ad6\u8a9e", "shape": "square", "size": 20}, {"id": "bibl00029", "label": "Letter to Xu Shoushang", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00029\\nTyp: bibliography\\nTitel: Letter to Xu Shoushang, 1918\u5e748\u670820\u65e5\u81f4\u8a31\u58fd\u88f3", "shape": "square", "size": 20}, {"id": "bibl00030", "label": "Zizhi Tongjian", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00030\\nTyp: bibliography\\nTitel: Zizhi Tongjian, \u8d44\u6cbb\u901a\u9274", "shape": "square", "size": 20}, {"id": "bibl00038", "label": "Glory to Hong Kong", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00038\\nTyp: bibliography\\nTitel: Glory to Hong Kong, \u9858\u69ae\u5149\u6b78\u9999\u6e2f", "shape": "square", "size": 20}, {"id": "bibl00039", "label": "Do\u202fyou\u202fhear\u202fthe\u202fPeople sing?\u202fGrenzen des (Un-)Sagbaren: Resilienz- und Protestkulturen in China", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00039\\nTyp: bibliography\\nTitel: Do\u202fyou\u202fhear\u202fthe\u202fPeople sing?\u202fGrenzen des (Un-)Sagbaren: Resilienz- und Protestkulturen in China", "shape": "square", "size": 20}, {"id": "bibl00040", "label": "HKU Student White Paper Protest Photograph", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00040\\nTyp: bibliography\\nTitel: HKU Student White Paper Protest Photograph", "shape": "square", "size": 20}, {"id": "bibl00041", "label": "Introducing a Cooperative", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00041\\nTyp: bibliography\\nTitel: Introducing a Cooperative, Red Flag, \u4ecb\u7ecd\u4e00\u4e2a\u5408\u4f5c\u793e\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00042", "label": "Gong Zizhen's \"Alas, the ten thousand horses are all silenced!\"", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00042\\nTyp: bibliography\\nTitel: Gong Zizhen's \"Alas, the ten thousand horses are all silenced!\", An Invocation to Heaven, \u4e07\u9a6c\u9f53\u7a76\u53ef\u54c0\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00043", "label": "Daxu", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00043\\nTyp: bibliography\\nTitel: Daxu, Book of Songs, \u5927\u5e8f\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00044", "label": "Hong Kong Court Bans Democracy Song, Calling It a \u2018Weapon\u2019", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00044\\nTyp: bibliography\\nTitel: Hong Kong Court Bans Democracy Song, Calling It a \u2018Weapon\u2019, New York Times", "shape": "square", "size": 20}, {"id": "bibl00045", "label": "Ai Qin", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00045\\nTyp: bibliography\\nTitel: Ai Qin, \u54c0\u79e6, Dongfang", "shape": "square", "size": 20}, {"id": "bibl00046", "label": "Guisui's Current Situation and Future", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00046\\nTyp: bibliography\\nTitel: Guisui's Current Situation and Future, \u6b78\u7d8f\u73fe\u72c0\u8207\u5c07\u4f86, Dongfang", "shape": "square", "size": 20}, {"id": "bibl00047", "label": "Freely discuss \"politics and economics\" and \"casual\" topics", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00047\\nTyp: bibliography\\nTitel: Freely discuss \"politics and economics\" and \"casual\" topics, Shenbao, \u81ea\u7531\u8ac7\u300c\u6b63\u7d93\u300d\u8207\u300c\u96a8\u4fbf\u300d\\n... und 1 weitere", "shape": "square", "size": 20}, {"id": "bibl00048", "label": "The Direction of Chinese Educational Philosophy", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00048\\nTyp: bibliography\\nTitel: The Direction of Chinese Educational Philosophy, Dongfang, \u4e2d\u570b\u6559\u80b2\u54f2\u5b78\u4e4b\u65b9\u5411", "shape": "square", "size": 20}, {"id": "bibl00049", "label": "Do You Hear the People Sing", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00049\\nTyp: bibliography\\nTitel: Do You Hear the People Sing", "shape": "square", "size": 20}, {"id": "bibl00050", "label": "One Year on From \u201cWhite Paper\u201d Protests, Disillusionment With China\u2019s Government Persists", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00050\\nTyp: bibliography\\nTitel: One Year on From \u201cWhite Paper\u201d Protests, Disillusionment With China\u2019s Government Persists", "shape": "square", "size": 20}, {"id": "bibl00051", "label": "Photograph of a White Paper in Heidelberg", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00051\\nTyp: bibliography\\nTitel: Photograph of a White Paper in Heidelberg", "shape": "square", "size": 20}, {"id": "bibl00052", "label": "Hexinliang \u00b7 ti caoshian ke xue ci", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00052\\nTyp: bibliography\\nTitel: Hexinliang \u00b7 ti caoshian ke xue ci, \u8cc0\u65b0\u51c9\u00b7\u984c\u66f9\u5be6\u5eb5\u73c2\u96ea\u8a5e", "shape": "square", "size": 20}, {"id": "bibl00053", "label": "Mengzi ziyi shuzheng", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00053\\nTyp: bibliography\\nTitel: Mengzi ziyi shuzheng, \u5b5f\u5b50\u5b57\u7fa9\u758f\u8b49", "shape": "square", "size": 20}, {"id": "bibl00054", "label": "A Madman's Diary: Comic on Lu Xun's Novel", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00054\\nTyp: bibliography\\nTitel: A Madman's Diary: Comic on Lu Xun's Novel, \u72c2\u4eba\u65e5\u8bb0: \u9c81\u8fc5\u5c0f\u8bf4\u8fde\u73af\u753b", "shape": "square", "size": 20}, {"id": "bibl00055", "label": "One hundred and four illustrations for 'Dead Souls' by N.V.Gogol", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00055\\nTyp: bibliography\\nTitel: One hundred and four illustrations for 'Dead Souls' by N.V.Gogol, Tote Seelen oder Tschitschikoffs Abenteuer. Mit 104 Zeichnungen von Alexander Agin., Sto chetyre risunika k poeme N. V. Gogolia 'Mertvye Dushi'", "shape": "square", "size": 20}, {"id": "bibl00056", "label": "The Red Laugh", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00056\\nTyp: bibliography\\nTitel: The Red Laugh, Das Rote Lachen", "shape": "square", "size": 20}, {"id": "bibl00057", "label": "How to Draw the Latest, Most Beautiful Pictures", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00057\\nTyp: bibliography\\nTitel: How to Draw the Latest, Most Beautiful Pictures, \u600e\u6837\u753b\u6700\u65b0\u6700\u7f8e\u7684\u56fe\u753b", "shape": "square", "size": 20}, {"id": "bibl00058", "label": "School Life Lu Xun and Chai Huofu", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00058\\nTyp: bibliography\\nTitel: School Life Lu Xun and Chai Huofu, \u5b78\u6821\u751f\u6d3b\u3000\u9b6f\u8fc5\u8207\u67f4\u970d\u752b", "shape": "square", "size": 20}, {"id": "bibl00059", "label": "A Blank Piece of Paper", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00059\\nTyp: bibliography\\nTitel: A Blank Piece of Paper, \u4e00\u5f20\u767d\u7eb8\u6761, \u4eba\u6c11\u65e5\u62a5", "shape": "square", "size": 20}, {"id": "bibl00060", "label": "The Eighth All-Union Congress of Soviets Adopted a New Constitution", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00060\\nTyp: bibliography\\nTitel: The Eighth All-Union Congress of Soviets Adopted a New Constitution, \u7b2c\u516b\u6b21\u5168\u8607\u5927\u6703\u901a\u904e\u65b0\u61b2\u6cd5, \u6771\u65b9\u65e9\u5831", "shape": "square", "size": 20}, {"id": "bibl00061", "label": "The One who Speaks Contributes Greatly", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00061\\nTyp: bibliography\\nTitel: The One who Speaks Contributes Greatly, \u8a00\u8005\u6709\u529f, \u4eba\u6c11\u65e5\u62a5", "shape": "square", "size": 20}, {"id": "bibl00062", "label": "Directive of the Central Committee of the Communist Party of China on the Rectification Movement", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00062\\nTyp: bibliography\\nTitel: Directive of the Central Committee of the Communist Party of China on the Rectification Movement, \u4e2d\u56fd\u5171\u4ea7\u515a\u4e2d\u592e\u59d4\u5458\u4f1a\u5173\u4e8e\u6574\u98ce\u8fd0\u52a8\u7684\u6307\u793a, \u4eba\u6c11\u65e5\u62a5", "shape": "square", "size": 20}, {"id": "bibl00063", "label": "Letter to Yuan Jiu", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00063\\nTyp: bibliography\\nTitel: Letter to Yuan Jiu, \u4e0e\u5143\u4e5d\u4e66", "shape": "square", "size": 20}, {"id": "bibl00064", "label": "People, Can You Hear?", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00064\\nTyp: bibliography\\nTitel: People, Can You Hear?, \u4eba\u4eec\uff0c\u4f60\u4eec\u53ef\u542c\u89c1?", "shape": "square", "size": 20}, {"id": "bibl00065", "label": "different anthems", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00065\\nTyp: bibliography\\nTitel: different anthems", "shape": "square", "size": 20}, {"id": "bibl00066", "label": "Voiceless China", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00066\\nTyp: bibliography\\nTitel: Voiceless China, \u7121\u8072\u7684\u4e2d\u570b, Stimmlosen China", "shape": "square", "size": 20}, {"id": "bibl00067", "label": "Dai Jitao", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00067\\nTyp: bibliography\\nTitel: Dai Jitao", "shape": "square", "size": 20}, {"id": "bibl00068", "label": "The East is Red", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00068\\nTyp: bibliography\\nTitel: The East is Red, \u4e1c\u65b9\u7ea2", "shape": "square", "size": 20}, {"id": "bibl00069", "label": "Big Character Poster", "type": "bibliography", "color": "#FFA500", "title": "ID: bibl00069\\nTyp: bibliography\\nTitel: Big Character Poster", "shape": "square", "size": 20}];
        
        var edgeData = [{"from": "bibl00025", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00001", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00021", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00020", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00014", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00015", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00016", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00006", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00017", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00018", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00019", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00011", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00003", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00004", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00005", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00007", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00008", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00009", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00010", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00012", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00013", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00022", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00024", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00026", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00027", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00028", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00029", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00031", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00032", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00033", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00034", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00035", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00036", "to": "bibl00023", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00037", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00030", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00021", "to": "bibl00022", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00038", "to": "bibl00022", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00044", "to": "bibl00038", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00038", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00041", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00041", "to": "bibl00042", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00041", "to": "bibl00043", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00045", "to": "bibl00042", "type": "PotCit", "hierarchy": "potential", "color": "#964B00", "date": "", "desc": "", "width": 2}, {"from": "bibl00046", "to": "bibl00042", "type": "PotCit", "hierarchy": "potential", "color": "#964B00", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00022", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00047", "type": "PotCit", "hierarchy": "potential", "color": "#964B00", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00048", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00049", "type": "CitIn", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00050", "to": "bibl00040", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00051", "to": "bibl00040", "type": "CitOf", "hierarchy": "primary", "color": "#FF4444", "date": "", "desc": "", "width": 2}, {"from": "bibl00042", "to": "bibl00052", "type": "ThirdCit", "hierarchy": "tertiary", "color": "#ADD8E6", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00053", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00054", "to": "bibl00023", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00055", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00023", "to": "bibl00056", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00057", "to": "bibl00041", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00057", "to": "bibl00040", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00058", "to": "bibl00023", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00059", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00060", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00040", "to": "bibl00061", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00061", "to": "bibl00062", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00061", "to": "bibl00063", "type": "NewCit", "hierarchy": "confirmed", "color": "#AA44AA", "date": "", "desc": "", "width": 2}, {"from": "bibl00064", "to": "bibl00049", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00065", "to": "bibl00049", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00041", "to": "bibl00066", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}, {"from": "bibl00066", "to": "bibl00067", "type": "ThirdCit", "hierarchy": "tertiary", "color": "#ADD8E6", "date": "", "desc": "", "width": 2}, {"from": "bibl00063", "to": "bibl00043", "type": "ThirdCit", "hierarchy": "tertiary", "color": "#ADD8E6", "date": "", "desc": "", "width": 2}, {"from": "bibl00065", "to": "bibl00068", "type": "ThirdCit", "hierarchy": "tertiary", "color": "#ADD8E6", "date": "", "desc": "", "width": 2}, {"from": "bibl00069", "to": "bibl00041", "type": "SecCit", "hierarchy": "secondary", "color": "#44AA44", "date": "", "desc": "", "width": 2}];
        
        // Hierarchy Definitions
        var relationHierarchies = {
            'primary': ['CitOf', 'CitIn'],
            'secondary': ['SecCit'], 
            'tertiary': ['ThirdCit'],
            'potential': ['PotCit'],
            'confirmed': ['NewCit'],
        };
        
        // Initialization on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Starting network initialization...');
            initializeNetwork();
        });
        
        function initializeNetwork() {
            try {
                // Create vis.js DataSets
                var visNodes = nodeData.map(function(node) {
                    return {
                        id: node.id,
                        label: node.label,
                        color: {
                            background: node.color,
                            border: '#333333'
                        },
                        font: {
                            color: 'black',
                            size: 12
                        },
                        shape: node.shape || 'square',
                        size: node.size || 20,
                        title: node.title
                    };
                });
                
                var visEdges = edgeData.map(function(edge) {
                    return {
                        from: edge.from,
                        to: edge.to,
                        color: edge.color,
                        width: edge.width || 2,
                        title: 'Relation: ' + edge.type + 
                               (edge.date ? '\nDate: ' + edge.date : '') +
                               (edge.desc ? '\nDescription: ' + edge.desc : '')
                    };
                });
                
                nodes = new vis.DataSet(visNodes);
                edges = new vis.DataSet(visEdges);
                
                allNodes = nodes.get();
                allEdges = edges.get();
                
                // Network Options
                var options = {
                    physics: {
                        enabled: true,
                        forceAtlas2Based: {
                            avoidOverlap: 0,
                            centralGravity: 0.01,
                            damping: 0.4,
                            gravitationalConstant: -50,
                            springConstant: 0.08,
                            springLength: 100
                        },
                        solver: 'forceAtlas2Based',
                        stabilization: {
                            enabled: true,
                            fit: true,
                            iterations: 1000,
                            onlyDynamicEdges: false,
                            updateInterval: 50
                        }
                    },
                    edges: {
                        color: {
                            inherit: true
                        },
                        smooth: {
                            enabled: true,
                            type: 'dynamic'
                        }
                    },
                    interaction: {
                        dragNodes: true,
                        hideEdgesOnDrag: false,
                        hideNodesOnDrag: false
                    },
                    configure: {
                        enabled: false
                    }
                };
                
                // Create the Network
                var container = document.getElementById('network-container');
                network = new vis.Network(container, {nodes: nodes, edges: edges}, options);
                
                // Initialize filters after network setup
                network.on('stabilizationIterationsDone', function() {
                    console.log('Network stabilized, initializing filters...');
                    populateNodeSelect();
                });
                
                console.log('Network successfully created:', allNodes.length, 'Nodes,', allEdges.length, 'Edges');
                
            } catch (e) {
                console.error('Network initialization error:', e);
            }
        }
        
        function populateNodeSelect() {
            var select = document.getElementById('node-select');
            if (select && nodeData) {
                // Remove existing options (except the first)
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
                
                // Sort nodes by label
                var sortedNodes = nodeData.slice().sort((a, b) => a.label.localeCompare(b.label));
                
                sortedNodes.forEach(function(node) {
                    var option = document.createElement('option');
                    option.value = node.id;
                    option.textContent = node.label.substring(0, 50) + '... (' + node.type + ')';
                    select.appendChild(option);
                });
            }
        }
        
        function filterByHierarchy(hierarchy) {
            currentHierarchy = hierarchy;
            console.log('Filtering by Hierarchy:', hierarchy);
            
            if (!network || !edgeData || !nodeData) {
                console.error('Network not yet initialized');
                return;
            }
            
            try {
                var primaryEdges = [];
                var filteredEdges = [];
                var highlightedNodes = new Set();
                
                // Collect baseline structure edges based on hierarchy
                edgeData.forEach(function(edge) {
                    if (!activeRelations.has(edge.type)) return;
                    
                    var isBaseStructure = false;
                    
                    // Determine which relations serve as baseline structure
                    if (hierarchy === 'secondary' || hierarchy === 'tertiary' || hierarchy === 'potential' || hierarchy === 'confirmed') {
                        // Primary relations are always baseline structure
                        if (edge.type === 'CitOf' || edge.type === 'CitIn') {
                            isBaseStructure = true;
                        }
                    }
                    
                    if (hierarchy === 'tertiary' || hierarchy === 'potential' || hierarchy === 'confirmed') {
                        // For tertiary and extended: also secondary as baseline structure
                        if (edge.type === 'SecCit') {
                            isBaseStructure = true;
                        }
                    }
                    
                    if (hierarchy === 'potential' || hierarchy === 'confirmed') {
                        // For extended: also tertiary as baseline structure
                        if (edge.type === 'ThirdCit') {
                            isBaseStructure = true;
                        }
                    }

                     if (hierarchy === 'confirmed') {
                        // For extended: also tertiary as baseline structure
                        if (edge.type === 'PotCit') {
                            isBaseStructure = true;
                        }
                    }
                    
                    if (isBaseStructure) {
                        primaryEdges.push({
                            from: edge.from,
                            to: edge.to,
                            color: '#DDDDDD',  // Gray baseline structure
                            width: 1,
                            title: 'Baseline Structure: ' + edge.type + 
                                   (edge.date ? '\nDate: ' + edge.date : '') +
                                   (edge.desc ? '\nDescription: ' + edge.desc : '')
                        });
                    }
                });
                
                // Collect filtered edges
                edgeData.forEach(function(edge) {
                    if (!activeRelations.has(edge.type)) return;
                    
                    var showEdge = false;
                    if (hierarchy === 'all') {
                        showEdge = true;
                    } else if (hierarchy === 'primary') {
                        showEdge = (edge.type === 'CitOf' || edge.type === 'CitIn');
                    } else if (hierarchy === 'secondary') {
                        showEdge = (edge.type === 'SecCit');
                    } else if (hierarchy === 'tertiary') {
                        showEdge = (edge.type === 'ThirdCit');
                    } else if (hierarchy === 'potential') {
                        showEdge = (edge.type === 'PotCit');
                    } else if (hierarchy === 'confirmed') {
                        showEdge = (edge.type === 'NewCit');
                    }
                    
                    if (showEdge) {
                        if (hierarchy !== 'primary' && hierarchy !== 'all' && 
                            (edge.type === 'SecCit' || edge.type === 'ThirdCit' || edge.type === 'PotCit' || edge.type === 'NewCit')) {
                            filteredEdges.push({
                                from: edge.from,
                                to: edge.to,
                                color: edge.color,
                                width: edge.width || 3,
                                title: 'Relation: ' + edge.type + 
                                       (edge.date ? '\nDate: ' + edge.date : '') +
                                       (edge.desc ? '\nDescription: ' + edge.desc : '')
                            });
                            highlightedNodes.add(edge.from);
                            highlightedNodes.add(edge.to);
                        } else if (hierarchy === 'primary' || hierarchy === 'all') {
                            filteredEdges.push({
                                from: edge.from,
                                to: edge.to,
                                color: edge.color,
                                width: edge.width || 2,
                                title: 'Relation: ' + edge.type + 
                                       (edge.date ? '\nDate: ' + edge.date : '') +
                                       (edge.desc ? '\nDescription: ' + edge.desc : '')
                            });
                            highlightedNodes.add(edge.from);
                            highlightedNodes.add(edge.to);
                        }
                    }
                });
                
                // Combine edges
                var finalEdges = [];
                if (hierarchy === 'secondary' || hierarchy === 'tertiary' || hierarchy === 'potential' || hierarchy === 'confirmed') {
                    finalEdges = primaryEdges.concat(filteredEdges);
                } else {
                    finalEdges = filteredEdges;
                }
                
                // Update nodes
                var updatedNodes = nodeData.map(function(node) {
                    var isHighlighted = highlightedNodes.has(node.id);
                    var isConnectedToPrimary = primaryEdges.some(function(edge) {
                        return edge.from === node.id || edge.to === node.id;
                    });
                    
                    return {
                        id: node.id,
                        label: node.label,
                        color: {
                            background: node.color,
                            border: '#333333'
                        },
                        font: { 
                            color: isHighlighted ? 'black' : (isConnectedToPrimary ? '#666666' : '#cccccc'),
                            size: 12
                        },
                        shape: node.shape || 'square',
                        size: isHighlighted ? (node.size || 20) : ((node.size || 20) * 0.8),
                        title: node.title
                    };
                });
                
                // Update the network
                nodes.clear();
                edges.clear();
                nodes.add(updatedNodes);
                edges.add(finalEdges);
                
                console.log('Filter applied:', finalEdges.length, 'Edges,', highlightedNodes.size, 'Nodes highlighted');
                
            } catch (e) {
                console.error('Filtering error:', e);
            }
        }
        
        function toggleRelation(relationType) {
            var checkbox = document.getElementById(relationType);
            if (checkbox) {
                if (checkbox.checked) {
                    activeRelations.add(relationType);
                } else {
                    activeRelations.delete(relationType);
                }
                console.log('Toggle Relation:', relationType, checkbox.checked);
                filterByHierarchy(currentHierarchy);
            }
        }
        
        function selectNode(nodeId) {
            if (!nodeId || !network) return;
            
            try {
                network.focus(nodeId, {
                    scale: 1.5,
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
                
                var connectedNodes = network.getConnectedNodes(nodeId);
                var nodesToHighlight = [nodeId].concat(connectedNodes);
                
                var updatedNodes = allNodes.map(function(node) {
                    var isHighlighted = nodesToHighlight.includes(node.id);
                    return {
                        ...node,
                        color: { 
                            background: node.color.background || node.color,
                            border: '#333333'
                        },
                        size: isHighlighted ? (node.id === nodeId ? 35 : 25) : 15,
                        font: { 
                            color: isHighlighted ? 'black' : '#999999',
                            size: 12
                        }
                    };
                });
                
                nodes.update(updatedNodes);
                
            } catch (e) {
                console.error('Node selection error:', e);
            }
        }
        
        function clearSelection() {
            console.log('Selection reset');
            
            var select = document.getElementById('node-select');
            if (select) select.selectedIndex = 0;
            
            filterByHierarchy(currentHierarchy);
        }
        
    </script>
</body>

</html>

